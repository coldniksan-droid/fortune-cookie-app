const { Telegraf } = require('telegraf');
require('dotenv').config();

const bot = new Telegraf(process.env.BOT_TOKEN);

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start
bot.start((ctx) => {
  const welcomeMessage = `ðŸ‘‹ ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ð¸ÑÐºÐ°Ñ‚ÐµÐ»ÑŒ!

Ð—Ð²ÐµÐ·Ð´Ñ‹ ÑÐ¾ÑˆÐ»Ð¸ÑÑŒ, Ð¸ Ð¿ÐµÑ‡ÐµÐ½ÑŒÐµ ÑƒÐ¶Ðµ Ð¸ÑÐ¿ÐµÐºÐ»Ð¾ÑÑŒ ÑÐ¿ÐµÑ†Ð¸Ð°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ñ‚ÐµÐ±Ñ. ÐžÐ½Ð¾ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ñ‚Ð°Ð¹Ð½Ñƒ Ñ‚Ð²Ð¾ÐµÐ³Ð¾ ÑÐµÐ³Ð¾Ð´Ð½ÑÑˆÐ½ÐµÐ³Ð¾ Ð´Ð½Ñ.

Ð“Ð¾Ñ‚Ð¾Ð² ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð´Ñƒ? Ð–Ð¼Ð¸ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð½Ð¸Ð¶Ðµ! ðŸ‘‡`;

  // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Mini App
  const keyboard = {
    inline_keyboard: [
      [
        {
          text: 'ðŸ”® Ð Ð°Ð·Ð»Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¿ÐµÑ‡ÐµÐ½ÑŒÐµ',
          web_app: { url: process.env.WEB_APP_URL || 'https://your-app.vercel.app' }
        }
      ]
    ]
  };

  ctx.reply(welcomeMessage, {
    reply_markup: keyboard
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /help
bot.help((ctx) => {
  ctx.reply(`ðŸ“– ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð¿Ð¾ Ð±Ð¾Ñ‚Ñƒ:

ðŸ”® Ð Ð°Ð·Ð»Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¿ÐµÑ‡ÐµÐ½ÑŒÐµ - Ð¾Ñ‚ÐºÑ€Ð¾Ð¹ Mini App Ð¸ ÑƒÐ·Ð½Ð°Ð¹ ÑÐ²Ð¾Ñ‘ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ
âœ¨ Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ - Ñ€Ð°Ð·Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐ¹ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹
ðŸ“¤ ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ - Ð¿Ð¾Ð´ÐµÐ»Ð¸ÑÑŒ ÑÐ²Ð¾Ð¸Ð¼ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸ÐµÐ¼ Ð² Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸

Ð£Ð´Ð°Ñ‡Ð¸! ðŸ€`);
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
bot.launch().then(() => {
  console.log('ðŸ¤– Ð‘Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!');
}).catch((err) => {
  console.error('ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°:', err);
});

// Graceful stop
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));

